<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AssetList Preview (Asset API v1)</title>
    <!-- External Dependencies -->
    <link href="https://unpkg.com/tabulator-tables@6.3.1/dist/css/tabulator.min.css" rel="stylesheet">
    <script src="https://unpkg.com/tabulator-tables@6.3.1/dist/js/tabulator.min.js"></script>
    <!-- Component CSS (inlined) -->
    <style>
        /* === component.css (inline) === */
        /* ======================
         * AssetList Component Styles
         * Container: #asset-list-container
         * ====================== */

        #asset-list-container {
            height: 100%;

            .asset-list-panel {
                display: flex;
                flex-direction: column;
                height: 100%;
                background: #0d1117;
                color: #e0e6ed;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            }

            /* Header */
            .panel-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 16px 20px;
                border-bottom: 1px solid #21262d;
            }

            .panel-title {
                margin: 0;
                font-size: 18px;
                font-weight: 600;
                color: #e0e6ed;
            }

            .refresh-btn {
                width: 32px;
                height: 32px;
                border: none;
                border-radius: 6px;
                background: #21262d;
                color: #8b949e;
                font-size: 16px;
                cursor: pointer;
                transition: all 0.2s;

                &:hover {
                    background: #30363d;
                    color: #e0e6ed;
                }
            }

            /* Split Layout */
            .split-layout {
                display: flex;
                flex: 1;
                overflow: hidden;
                padding: 0;
            }

            /* Tree Pane */
            .tree-pane {
                width: 280px;
                min-width: 200px;
                max-width: 400px;
                display: flex;
                flex-direction: column;
                background: #0d1117;
                border-right: 1px solid #21262d;
            }

            .tree-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 12px 16px;
                border-bottom: 1px solid #21262d;
            }

            .tree-title {
                font-size: 13px;
                font-weight: 600;
                color: #8b949e;
            }

            .tree-controls {
                display: flex;
                gap: 4px;
            }

            .tree-controls button {
                width: 24px;
                height: 24px;
                padding: 0;
                font-size: 10px;
                border: none;
                border-radius: 4px;
                background: #21262d;
                color: #8b949e;
                cursor: pointer;
                transition: all 0.15s;
            }

            .tree-controls button:hover {
                background: #30363d;
                color: #e0e6ed;
            }

            .tree-search {
                padding: 8px 12px;
                border-bottom: 1px solid #21262d;
            }

            .tree-search-input {
                width: 100%;
                padding: 6px 10px;
                font-size: 12px;
                border: 1px solid #30363d;
                border-radius: 4px;
                background: #161b22;
                color: #e0e6ed;
                box-sizing: border-box;
            }

            .tree-search-input:focus {
                outline: none;
                border-color: #58a6ff;
            }

            .tree-search-input::placeholder {
                color: #6e7681;
            }

            .tree-container {
                flex: 1;
                overflow-y: auto;
                padding: 8px 0;
            }

            .tree-root {
                margin: 0;
                padding: 0;
                list-style: none;
            }

            /* Tree Node */
            .tree-node {
                margin: 0;
                padding: 0;
                list-style: none;
                /* ÏÑ±Îä• ÏµúÏ†ÅÌôî: Î∑∞Ìè¨Ìä∏ Î∞ñ ÎÖ∏Îìú Î†åÎçîÎßÅ Ïä§ÌÇµ */
                content-visibility: auto;
                contain-intrinsic-size: auto 32px;
            }

            .node-content {
                display: flex;
                align-items: center;
                padding: 6px 12px;
                cursor: pointer;
                transition: background 0.15s;
            }

            .node-content:hover {
                background: #161b22;
            }

            .node-content.selected {
                background: #1f6feb33;
            }

            .node-toggle {
                width: 16px;
                height: 16px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 8px;
                color: #8b949e;
                transition: transform 0.2s;
                flex-shrink: 0;
            }

            .node-toggle.expanded {
                transform: rotate(90deg);
            }

            .node-toggle.leaf {
                visibility: hidden;
            }

            .node-icon {
                width: 18px;
                height: 18px;
                margin-right: 6px;
                font-size: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            /* Í≥µÍ∞Ñ Í≥ÑÏ∏µ */
            .node-icon[data-type="building"]::before { content: "üè¢"; }
            .node-icon[data-type="floor"]::before { content: "üìÇ"; }
            .node-icon[data-type="room"]::before { content: "üö™"; }
            /* Ïû•ÎπÑ Ïª®ÌÖåÏù¥ÎÑà */
            .node-icon[data-type="rack"]::before { content: "üóÑÔ∏è"; }
            .node-icon[data-type="cabinet"]::before { content: "üì¶"; }
            .node-icon[data-type="pdu"]::before { content: "üîå"; }
            /* ÎßêÎã® ÏûêÏÇ∞ */
            .node-icon[data-type="server"]::before { content: "üñ•Ô∏è"; }
            .node-icon[data-type="storage"]::before { content: "üíæ"; }
            .node-icon[data-type="switch"]::before { content: "üîÄ"; }
            .node-icon[data-type="router"]::before { content: "üì∂"; }
            .node-icon[data-type="ups"]::before { content: "üîã"; }
            .node-icon[data-type="crac"]::before { content: "‚ùÑÔ∏è"; }
            .node-icon[data-type="sensor"]::before { content: "üì°"; }
            .node-icon[data-type="circuit"]::before { content: "‚ö°"; }

            .node-label {
                flex: 1;
                font-size: 13px;
                color: #e0e6ed;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .node-asset-count {
                font-size: 11px;
                color: #8b949e;
                margin-left: 8px;
            }

            .node-status {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                margin-left: 6px;
                flex-shrink: 0;
            }

            .node-status.normal { background: #3fb950; }
            .node-status.warning { background: #d29922; }
            .node-status.critical { background: #f85149; }

            .node-children {
                margin: 0;
                padding: 0;
                padding-left: 16px;
                list-style: none;
                display: none;
            }

            .node-children.expanded {
                display: block;
            }

            /* Loading Placeholder (Lazy Loading) */
            .loading-placeholder {
                padding: 6px 12px;
            }

            .loading-text {
                font-size: 12px;
                color: #6e7681;
                font-style: italic;
            }

            /* Pane Resizer */
            .pane-resizer {
                width: 4px;
                background: #21262d;
                cursor: col-resize;
                transition: background 0.2s;
            }

            .pane-resizer:hover,
            .pane-resizer.dragging {
                background: #58a6ff;
            }

            /* Table Pane */
            .table-pane {
                flex: 1;
                display: flex;
                flex-direction: column;
                min-width: 400px;
                overflow: hidden;
            }

            .selected-node-info {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 8px 16px;
                background: #161b22;
                border-bottom: 1px solid #21262d;
            }

            .node-path {
                font-size: 13px;
                font-weight: 500;
                color: #e0e6ed;
            }

            .selected-node-info .node-count {
                font-size: 12px;
                color: #8b949e;
            }

            /* Toolbar */
            .toolbar {
                display: flex;
                gap: 12px;
                padding: 12px 16px;
                border-bottom: 1px solid #21262d;
            }

            .search-box {
                flex: 1;
            }

            .search-input {
                width: 100%;
                padding: 8px 12px;
                border: 1px solid #30363d;
                border-radius: 6px;
                background: #161b22;
                color: #e0e6ed;
                font-size: 14px;
                box-sizing: border-box;

                &:focus {
                    outline: none;
                    border-color: #58a6ff;
                }

                &::placeholder {
                    color: #6e7681;
                }
            }

            .filter-box {
                display: flex;
                gap: 8px;
            }

            .type-filter,
            .status-filter {
                padding: 8px 12px;
                border: 1px solid #30363d;
                border-radius: 6px;
                background: #161b22;
                color: #e0e6ed;
                font-size: 14px;
                cursor: pointer;

                &:focus {
                    outline: none;
                    border-color: #58a6ff;
                }
            }

            /* Table Container */
            .table-container {
                flex: 1;
                padding: 16px;
                overflow: hidden;
            }

            /* Footer */
            .panel-footer {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 12px 20px;
                border-top: 1px solid #21262d;
            }

            .legend {
                display: flex;
                gap: 16px;
            }

            .legend-item {
                display: flex;
                align-items: center;
                gap: 6px;
                font-size: 12px;
                color: #8b949e;
            }

            .dot {
                width: 8px;
                height: 8px;
                border-radius: 50%;

                &.normal { background: #3fb950; }
                &.warning { background: #d29922; }
                &.critical { background: #f85149; }
            }

            .asset-count {
                display: flex;
                align-items: center;
                gap: 6px;
                font-size: 13px;
            }

            .count-label {
                color: #8b949e;
            }

            .count-value {
                color: #e0e6ed;
                font-weight: 600;
            }

            /* Tabulator Dark Theme Override */
            .tabulator {
                background: transparent;
                border: none;

                .tabulator-header {
                    background: #161b22;
                    border-bottom: 1px solid #30363d;

                    .tabulator-col {
                        background: transparent;
                        border-right: none;
                    }

                    .tabulator-col-content {
                        padding: 12px 16px;
                    }

                    .tabulator-col-title {
                        color: #8b949e;
                        font-size: 12px;
                        font-weight: 600;
                        text-transform: uppercase;
                    }
                }

                .tabulator-tableholder .tabulator-table {
                    background: transparent;
                }

                .tabulator-row {
                    background: transparent;
                    border-bottom: 1px solid #21262d;
                    cursor: pointer;
                    transition: background 0.15s;

                    &:hover {
                        background: #161b22;
                    }

                    &.tabulator-selected {
                        background: #1f6feb33;
                    }
                }

                .tabulator-cell {
                    padding: 12px 16px;
                    border-right: none;
                    color: #e0e6ed;
                    font-size: 14px;
                }
            }

            /* Status Badge */
            .status-badge {
                display: inline-block;
                padding: 4px 8px;
                border-radius: 12px;
                font-size: 11px;
                font-weight: 600;
                text-transform: uppercase;

                &[data-status="normal"] {
                    background: rgba(63, 185, 80, 0.15);
                    color: #3fb950;
                }

                &[data-status="warning"] {
                    background: rgba(210, 153, 34, 0.15);
                    color: #d29922;
                }

                &[data-status="critical"] {
                    background: rgba(248, 81, 73, 0.15);
                    color: #f85149;
                }
            }

            /* Type Badge */
            .type-badge {
                display: inline-block;
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 11px;
                font-weight: 600;
                text-transform: uppercase;
                background: #30363d;
                color: #8b949e;

                /* Ïù∏ÌîÑÎùº */
                &[data-type="building"],
                &[data-type="floor"],
                &[data-type="room"] {
                    background: rgba(139, 148, 158, 0.15);
                    color: #8b949e;
                }

                /* Ïª®ÌÖåÏù¥ÎÑà Ïû•ÎπÑ */
                &[data-type="rack"],
                &[data-type="cabinet"] {
                    background: rgba(121, 192, 255, 0.15);
                    color: #79c0ff;
                }

                /* Ï†ÑÏõê */
                &[data-type="ups"] {
                    background: rgba(88, 166, 255, 0.15);
                    color: #58a6ff;
                }

                &[data-type="pdu"] {
                    background: rgba(163, 113, 247, 0.15);
                    color: #a371f7;
                }

                &[data-type="circuit"] {
                    background: rgba(187, 128, 255, 0.15);
                    color: #bb80ff;
                }

                /* ÎÉâÍ∞Å */
                &[data-type="crac"] {
                    background: rgba(63, 185, 80, 0.15);
                    color: #3fb950;
                }

                /* ÏÑºÏÑú */
                &[data-type="sensor"] {
                    background: rgba(210, 153, 34, 0.15);
                    color: #d29922;
                }

                /* Ïª¥Ìì®ÌåÖ */
                &[data-type="server"] {
                    background: rgba(255, 123, 114, 0.15);
                    color: #ff7b72;
                }

                &[data-type="storage"] {
                    background: rgba(255, 166, 87, 0.15);
                    color: #ffa657;
                }

                /* ÎÑ§Ìä∏ÏõåÌÅ¨ */
                &[data-type="switch"],
                &[data-type="router"] {
                    background: rgba(126, 231, 135, 0.15);
                    color: #7ee787;
                }
            }

            /* ======================
             * Tabulator Pagination (Dark Theme)
             * ====================== */
            .tabulator-footer {
                background: #161b22 !important;
                border-top: 1px solid #21262d !important;
                color: #8b949e !important;
                padding: 8px 12px !important;
            }

            .tabulator-paginator {
                display: flex;
                align-items: center;
                gap: 8px;
                color: #8b949e !important;
            }

            .tabulator-page-size {
                background: #21262d !important;
                border: 1px solid #30363d !important;
                border-radius: 4px !important;
                color: #e0e6ed !important;
                padding: 4px 8px !important;
                font-size: 12px !important;
                cursor: pointer;

                &:focus {
                    outline: none;
                    border-color: #58a6ff !important;
                }
            }

            .tabulator-pages {
                display: flex;
                gap: 4px;
            }

            .tabulator-page {
                background: #21262d !important;
                border: 1px solid #30363d !important;
                border-radius: 4px !important;
                color: #8b949e !important;
                padding: 4px 10px !important;
                font-size: 12px !important;
                cursor: pointer;
                transition: all 0.15s;

                &:hover:not(.active):not([disabled]) {
                    background: #30363d !important;
                    color: #e0e6ed !important;
                }

                &.active {
                    background: #238636 !important;
                    border-color: #238636 !important;
                    color: #fff !important;
                }

                &[disabled] {
                    opacity: 0.4;
                    cursor: not-allowed;
                }
            }

            .tabulator-page-counter {
                color: #8b949e !important;
                font-size: 12px !important;
                margin-left: auto;
            }

            /* ======================
             * Asset Detail Modal
             * ====================== */
            .asset-modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                z-index: 1000;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .asset-modal[hidden] {
                display: none;
            }

            .modal-overlay {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
            }

            .modal-content {
                position: relative;
                background: #1a1f2e;
                border-radius: 12px;
                width: 480px;
                max-width: 90vw;
                max-height: 80vh;
                overflow: hidden;
                box-shadow: 0 24px 48px rgba(0, 0, 0, 0.4);
                border: 1px solid #2a3142;
            }

            .modal-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 16px 20px;
                border-bottom: 1px solid #2a3142;
            }

            .modal-title-area {
                display: flex;
                flex-direction: column;
                gap: 2px;
            }

            .modal-title {
                margin: 0;
                font-size: 16px;
                font-weight: 600;
                color: #e0e6ed;
            }

            .modal-subtitle {
                font-size: 12px;
                color: #8b949e;
            }

            .modal-header-right {
                display: flex;
                align-items: center;
                gap: 12px;
            }

            .modal-status {
                padding: 4px 10px;
                border-radius: 12px;
                font-size: 11px;
                font-weight: 500;
                text-transform: capitalize;
            }

            .modal-status[data-status="normal"] {
                background: rgba(63, 185, 80, 0.15);
                color: #3fb950;
            }

            .modal-status[data-status="warning"] {
                background: rgba(210, 153, 34, 0.15);
                color: #d29922;
            }

            .modal-status[data-status="critical"] {
                background: rgba(248, 81, 73, 0.15);
                color: #f85149;
            }

            .modal-close-btn {
                width: 28px;
                height: 28px;
                padding: 0;
                border: none;
                border-radius: 6px;
                background: transparent;
                color: #8b949e;
                font-size: 20px;
                line-height: 1;
                cursor: pointer;
                transition: background 0.15s, color 0.15s;
            }

            .modal-close-btn:hover {
                background: #30363d;
                color: #e0e6ed;
            }

            .modal-body {
                padding: 20px;
                overflow-y: auto;
                max-height: calc(80vh - 80px);
            }

            .modal-info-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .modal-info-item {
                background: #252b3b;
                border-radius: 8px;
                padding: 12px;
            }

            .modal-info-item.wide {
                grid-column: span 2;
            }

            .modal-info-label {
                font-size: 11px;
                color: #8b949e;
                text-transform: uppercase;
                margin-bottom: 4px;
            }

            .modal-info-value {
                font-size: 16px;
                font-weight: 600;
                color: #e0e6ed;
            }

            .modal-info-value.small {
                font-size: 14px;
            }

            .modal-no-api {
                text-align: center;
                padding: 24px;
                color: #8b949e;
            }

            .modal-no-api-icon {
                font-size: 32px;
                margin-bottom: 12px;
            }

            .modal-no-api-text {
                font-size: 14px;
            }

            .modal-loading {
                text-align: center;
                padding: 40px;
                color: #8b949e;
            }

            .modal-loading::after {
                content: '';
                display: inline-block;
                width: 24px;
                height: 24px;
                border: 2px solid #30363d;
                border-top-color: #58a6ff;
                border-radius: 50%;
                animation: modal-spin 0.8s linear infinite;
            }

            @keyframes modal-spin {
                to { transform: rotate(360deg); }
            }

            /* ======================
             * Responsive Layout
             * Ïª®ÌÖåÏù¥ÎÑà ÎÑàÎπÑ 768px Ïù¥Ìïò: Ìä∏Î¶¨/ÌÖåÏù¥Î∏î ÏÑ∏Î°ú Î∞∞Ïπò
             * ====================== */
            @container (max-width: 768px) {
                .split-layout {
                    flex-direction: column;
                }

                .tree-pane {
                    width: 100%;
                    max-width: none;
                    min-width: auto;
                    max-height: 35vh;
                    border-right: none;
                    border-bottom: 1px solid #21262d;
                }

                .pane-resizer {
                    display: none;
                }

                .table-pane {
                    min-width: auto;
                }

                .toolbar {
                    flex-wrap: wrap;
                }

                .filter-box {
                    width: 100%;
                }

                .type-filter,
                .status-filter {
                    flex: 1;
                }
            }
        }

        /* Container Query ÏßÄÏõêÏùÑ ÏúÑÌïú Ïª®ÌÖåÏù¥ÎÑà Ï†ïÏùò */
        #asset-list-container {
            container-type: inline-size;
            container-name: asset-list;
        }
    </style>
    <style>
        /* Reset & Base */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0f1219;
            padding: 32px;
        }
    </style>
</head>
<body>
    <!-- Ïª®ÌÖåÏù¥ÎÑà ID: #asset-list-container -->
    <div id="asset-list-container">
        <!-- views/component.html ÎÇ¥Ïö© -->
        <div class="asset-list-panel">
            <div class="panel-header">
                <h2 class="panel-title">Asset List</h2>
                <button class="refresh-btn" title="Refresh">‚Üª</button>
            </div>

            <div class="panel-body split-layout">
                <!-- Tree Pane -->
                <div class="tree-pane">
                    <div class="tree-header">
                        <span class="tree-title">Hierarchy</span>
                        <div class="tree-controls">
                            <button class="btn-collapse-all" title="Collapse All">‚ñ∂</button>
                        </div>
                    </div>
                    <div class="tree-search">
                        <input type="text" class="tree-search-input" placeholder="Search hierarchy...">
                    </div>
                    <div class="tree-container">
                        <ul class="tree-root"></ul>
                    </div>
                </div>

                <!-- Resizer -->
                <div class="pane-resizer"></div>

                <!-- Table Pane -->
                <div class="table-pane">
                    <div class="selected-node-info">
                        <span class="node-path">All Assets</span>
                        <span class="node-count">0</span>
                    </div>

                    <div class="toolbar">
                        <div class="search-box">
                            <input type="text" class="search-input" placeholder="Search by name or ID...">
                        </div>

                        <div class="filter-box">
                            <select class="type-filter">
                                <option value="all">All Types</option>
                                <option value="ups">UPS</option>
                                <option value="pdu">PDU</option>
                                <option value="crac">CRAC</option>
                                <option value="sensor">Sensor</option>
                            </select>

                            <select class="status-filter">
                                <option value="all">All Status</option>
                                <option value="normal">Normal</option>
                                <option value="warning">Warning</option>
                                <option value="critical">Critical</option>
                            </select>
                        </div>
                    </div>

                    <div class="table-container"></div>
                </div>
            </div>

            <div class="panel-footer">
                <div class="legend">
                    <span class="legend-item"><span class="dot normal"></span> Normal</span>
                    <span class="legend-item"><span class="dot warning"></span> Warning</span>
                    <span class="legend-item"><span class="dot critical"></span> Critical</span>
                </div>
                <div class="asset-count">
                    <span class="count-label">Total:</span>
                    <span class="count-value">0</span>
                </div>
            </div>

            <!-- Asset Detail Modal -->
            <div class="asset-modal" hidden>
                <div class="modal-overlay"></div>
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title-area">
                            <h3 class="modal-title">-</h3>
                            <span class="modal-subtitle">-</span>
                        </div>
                        <div class="modal-header-right">
                            <span class="modal-status" data-status="normal">Normal</span>
                            <button class="modal-close-btn" type="button" aria-label="Close">√ó</button>
                        </div>
                    </div>
                    <div class="modal-body">
                        <div class="modal-info-grid"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mock Data & API -->
    <script>
        // ======================
        // MOCK DATA (ÏÑúÎ≤Ñ ÏóÜÏù¥ ÌîÑÎ¶¨Î∑∞ ÎèôÏûë)
        // ======================

        // Mock Asset Î™©Î°ù - Ìä∏Î¶¨ Íµ¨Ï°∞Î•º ÏúÑÌïú Í≥ÑÏ∏µÏ†Å Îç∞Ïù¥ÌÑ∞
        const mockAssets = [
            // Root: Data Center
            { assetKey: 'DC-001', name: 'Data Center', assetType: 'FACILITY', statusType: 'ACTIVE' },

            // Level 1: Zones
            { assetKey: 'ZONE-A', name: 'Zone A', assetType: 'ZONE', statusType: 'ACTIVE' },
            { assetKey: 'ZONE-B', name: 'Zone B', assetType: 'ZONE', statusType: 'WARNING' },
            { assetKey: 'ZONE-C', name: 'Zone C', assetType: 'ZONE', statusType: 'CRITICAL' },

            // Level 2: Equipment in Zone A
            { assetKey: 'UPS-A01', name: 'UPS-A01', assetType: 'UPS', statusType: 'ACTIVE' },
            { assetKey: 'PDU-A01', name: 'PDU-A01', assetType: 'PDU', statusType: 'ACTIVE' },
            { assetKey: 'CRAC-A01', name: 'CRAC-A01', assetType: 'CRAC', statusType: 'ACTIVE' },
            { assetKey: 'SENSOR-A01', name: 'Sensor-A01', assetType: 'SENSOR', statusType: 'ACTIVE' },

            // Level 2: Equipment in Zone B
            { assetKey: 'UPS-B01', name: 'UPS-B01', assetType: 'UPS', statusType: 'WARNING' },
            { assetKey: 'PDU-B01', name: 'PDU-B01', assetType: 'PDU', statusType: 'ACTIVE' },
            { assetKey: 'CRAC-B01', name: 'CRAC-B01', assetType: 'CRAC', statusType: 'WARNING' },
            { assetKey: 'SENSOR-B01', name: 'Sensor-B01', assetType: 'SENSOR', statusType: 'WARNING' },

            // Level 2: Equipment in Zone C
            { assetKey: 'UPS-C01', name: 'UPS-C01', assetType: 'UPS', statusType: 'CRITICAL' },
            { assetKey: 'PDU-C01', name: 'PDU-C01', assetType: 'PDU', statusType: 'CRITICAL' },
            { assetKey: 'CRAC-C01', name: 'CRAC-C01', assetType: 'CRAC', statusType: 'CRITICAL' },
            { assetKey: 'SENSOR-C01', name: 'Sensor-C01', assetType: 'SENSOR', statusType: 'CRITICAL' },
        ];

        // Mock Relation Î™©Î°ù - Î∂ÄÎ™®-ÏûêÏãù Í¥ÄÍ≥Ñ (fromAssetKey = ÏûêÏãù, toAssetKey = Î∂ÄÎ™®)
        const mockRelations = [
            // Zones ‚Üí Data Center
            { fromAssetKey: 'ZONE-A', toAssetKey: 'DC-001' },
            { fromAssetKey: 'ZONE-B', toAssetKey: 'DC-001' },
            { fromAssetKey: 'ZONE-C', toAssetKey: 'DC-001' },

            // Equipment ‚Üí Zone A
            { fromAssetKey: 'UPS-A01', toAssetKey: 'ZONE-A' },
            { fromAssetKey: 'PDU-A01', toAssetKey: 'ZONE-A' },
            { fromAssetKey: 'CRAC-A01', toAssetKey: 'ZONE-A' },
            { fromAssetKey: 'SENSOR-A01', toAssetKey: 'ZONE-A' },

            // Equipment ‚Üí Zone B
            { fromAssetKey: 'UPS-B01', toAssetKey: 'ZONE-B' },
            { fromAssetKey: 'PDU-B01', toAssetKey: 'ZONE-B' },
            { fromAssetKey: 'CRAC-B01', toAssetKey: 'ZONE-B' },
            { fromAssetKey: 'SENSOR-B01', toAssetKey: 'ZONE-B' },

            // Equipment ‚Üí Zone C
            { fromAssetKey: 'UPS-C01', toAssetKey: 'ZONE-C' },
            { fromAssetKey: 'PDU-C01', toAssetKey: 'ZONE-C' },
            { fromAssetKey: 'CRAC-C01', toAssetKey: 'ZONE-C' },
            { fromAssetKey: 'SENSOR-C01', toAssetKey: 'ZONE-C' },
        ];

        // Mock AssetDetailUnified - ÌÜµÌï© API ÏùëÎãµ Íµ¨Ï°∞ (assetKeyÎ≥Ñ)
        const mockAssetDetails = {
            'UPS-A01': {
                asset: { name: 'UPS-A01', locationLabel: 'Zone-A', statusType: 'ACTIVE' },
                properties: [
                    { label: 'Load', value: '45%', helpText: 'Current load percentage', displayOrder: 1 },
                    { label: 'Battery', value: '100%', helpText: 'Battery charge level', displayOrder: 2 },
                    { label: 'Input', value: '220V', helpText: 'Input voltage', displayOrder: 3 },
                    { label: 'Output', value: '220V', helpText: 'Output voltage', displayOrder: 4 },
                    { label: 'Runtime', value: '120min', helpText: 'Estimated runtime', displayOrder: 5 },
                    { label: 'Mode', value: 'Online', helpText: 'Operating mode', displayOrder: 6 }
                ]
            },
            'UPS-B01': {
                asset: { name: 'UPS-B01', locationLabel: 'Zone-B', statusType: 'WARNING' },
                properties: [
                    { label: 'Load', value: '78%', helpText: 'Current load - HIGH', displayOrder: 1 },
                    { label: 'Battery', value: '65%', helpText: 'Battery charge level', displayOrder: 2 },
                    { label: 'Input', value: '218V', helpText: 'Input voltage', displayOrder: 3 },
                    { label: 'Output', value: '220V', helpText: 'Output voltage', displayOrder: 4 },
                    { label: 'Runtime', value: '45min', helpText: 'Estimated runtime', displayOrder: 5 },
                    { label: 'Mode', value: 'Online', helpText: 'Operating mode', displayOrder: 6 }
                ]
            },
            'UPS-C01': {
                asset: { name: 'UPS-C01', locationLabel: 'Zone-C', statusType: 'CRITICAL' },
                properties: [
                    { label: 'Load', value: '95%', helpText: 'Current load - CRITICAL', displayOrder: 1 },
                    { label: 'Battery', value: '15%', helpText: 'Battery LOW', displayOrder: 2 },
                    { label: 'Input', value: '0V', helpText: 'Power Failure', displayOrder: 3 },
                    { label: 'Output', value: '220V', helpText: 'Output voltage', displayOrder: 4 },
                    { label: 'Runtime', value: '8min', helpText: 'Estimated runtime', displayOrder: 5 },
                    { label: 'Mode', value: 'Battery', helpText: 'Operating mode', displayOrder: 6 }
                ]
            },
            'PDU-A01': {
                asset: { name: 'PDU-A01', locationLabel: 'Zone-A', statusType: 'ACTIVE' },
                properties: [
                    { label: 'Power', value: '45.2kW', helpText: 'Total power consumption', displayOrder: 1 },
                    { label: 'Current', value: '65.5A', helpText: 'Total current draw', displayOrder: 2 },
                    { label: 'Voltage', value: '220V', helpText: 'Input voltage', displayOrder: 3 },
                    { label: 'Active', value: '18/24', helpText: 'Active circuits', displayOrder: 4 },
                    { label: 'PF', value: '0.95', helpText: 'Power factor', displayOrder: 5 }
                ]
            },
            'CRAC-A01': {
                asset: { name: 'CRAC-A01', locationLabel: 'Zone-A', statusType: 'ACTIVE' },
                properties: [
                    { label: 'Supply Temp', value: '18.2¬∞C', helpText: 'Supply air temperature', displayOrder: 1 },
                    { label: 'Return Temp', value: '24.5¬∞C', helpText: 'Return air temperature', displayOrder: 2 },
                    { label: 'Humidity', value: '48%', helpText: 'Relative humidity', displayOrder: 3 },
                    { label: 'Fan Speed', value: '75%', helpText: 'Fan speed percentage', displayOrder: 4 },
                    { label: 'Setpoint', value: '18.0¬∞C', helpText: 'Temperature setpoint', displayOrder: 5 },
                    { label: 'Mode', value: 'Cooling', helpText: 'Operating mode', displayOrder: 6 }
                ]
            },
            'SENSOR-A01': {
                asset: { name: 'Sensor-A01', locationLabel: 'Zone-A', statusType: 'ACTIVE' },
                properties: [
                    { label: 'Temperature', value: '24.5¬∞C', helpText: 'Current temperature', displayOrder: 1 },
                    { label: 'Humidity', value: '48%', helpText: 'Current humidity', displayOrder: 2 }
                ]
            }
        };

        // Í∏∞Î≥∏ properties ÏÉùÏÑ± (ÏÉÅÏÑ∏ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÎäî ÏûêÏÇ∞Ïö©)
        function getDefaultProperties(asset) {
            return {
                asset: { name: asset.name, locationLabel: 'Unknown', statusType: asset.statusType },
                properties: [
                    { label: 'Asset Key', value: asset.assetKey, helpText: 'Unique identifier', displayOrder: 1 },
                    { label: 'Type', value: asset.assetType, helpText: 'Asset type', displayOrder: 2 },
                    { label: 'Status', value: asset.statusType, helpText: 'Current status', displayOrder: 3 }
                ]
            };
        }

        // ======================
        // MOCK API Functions
        // ======================

        /**
         * Mock: POST /api/v1/ast/l - ÏûêÏÇ∞ Ï†ÑÏ≤¥ Î™©Î°ù
         */
        async function fetchAssetList() {
            console.log('[Mock API] fetchAssetList');
            return { response: { data: mockAssets } };
        }

        /**
         * Mock: POST /api/v1/rel/l - Í¥ÄÍ≥Ñ Ï†ÑÏ≤¥ Î™©Î°ù
         */
        async function fetchRelationList() {
            console.log('[Mock API] fetchRelationList');
            return { response: { data: mockRelations } };
        }

        /**
         * Mock: POST /api/v1/ast/gx - ÏûêÏÇ∞ ÌÜµÌï© ÏÉÅÏÑ∏ Ï°∞Ìöå (assetDetailUnified)
         */
        async function fetchAssetDetailUnified(assetKey) {
            console.log('[Mock API] fetchAssetDetailUnified:', assetKey);

            // ÏÉÅÏÑ∏ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÏúºÎ©¥ Î∞òÌôò
            if (mockAssetDetails[assetKey]) {
                return { response: { data: mockAssetDetails[assetKey] } };
            }

            // ÏóÜÏúºÎ©¥ Í∏∞Î≥∏ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±
            const asset = mockAssets.find(a => a.assetKey === assetKey);
            if (asset) {
                return { response: { data: getDefaultProperties(asset) } };
            }

            return { response: { data: null } };
        }

        // ======================
        // STATUS TRANSFORM
        // ======================
        function statusTypeToLabel(statusType) {
            const labels = {
                ACTIVE: 'Normal',
                WARNING: 'Warning',
                CRITICAL: 'Critical',
                INACTIVE: 'Inactive',
                MAINTENANCE: 'Maintenance',
            };
            return labels[statusType] || statusType;
        }

        function statusTypeToDataAttr(statusType) {
            const map = {
                ACTIVE: 'normal',
                WARNING: 'warning',
                CRITICAL: 'critical',
                INACTIVE: 'inactive',
                MAINTENANCE: 'maintenance',
            };
            return map[statusType] || 'normal';
        }
    </script>

    <!-- Render Test -->
    <script>
        const container = document.getElementById('asset-list-container');
        const panel = container.querySelector('.asset-list-panel');

        // State (Asset API v1)
        let _assets = [];           // Ï†ÑÏ≤¥ ÏûêÏÇ∞ Î™©Î°ù
        let _relations = [];        // Ï†ÑÏ≤¥ Í¥ÄÍ≥Ñ Î™©Î°ù
        let _treeData = null;       // ÎπåÎìúÎêú Ìä∏Î¶¨ Îç∞Ïù¥ÌÑ∞
        let expandedNodes = new Set();
        let selectedNodeId = null;
        let _filteredAssets = [];   // ÏÑ†ÌÉùÎêú ÎÖ∏Îìú ÌïòÏúÑ ÏûêÏÇ∞
        let searchTerm = '';
        let treeSearchTerm = '';
        let typeFilter = 'all';
        let statusFilter = 'all';
        let tableInstance = null;

        // ==================
        // TREE BUILD (Asset + Relation)
        // ==================

        /**
         * Asset + Relation Îç∞Ïù¥ÌÑ∞Î°ú Ìä∏Î¶¨ Íµ¨Ï°∞ ÎπåÎìú
         */
        function buildTree() {
            // 1. assetKey ‚Üí asset Îßµ ÏÉùÏÑ±
            const assetMap = new Map();
            _assets.forEach(asset => assetMap.set(asset.assetKey, { ...asset, children: [] }));

            // 2. RelationÏúºÎ°ú Î∂ÄÎ™®-ÏûêÏãù Í¥ÄÍ≥Ñ ÏÑ§Ï†ï
            // fromAssetKey = ÏûêÏãù, toAssetKey = Î∂ÄÎ™®
            const childToParent = new Map();
            _relations.forEach(({ fromAssetKey, toAssetKey }) => {
                childToParent.set(fromAssetKey, toAssetKey);
            });

            // 3. Ìä∏Î¶¨ Íµ¨Ï°∞ ÎπåÎìú
            const rootNodes = [];
            assetMap.forEach((asset, assetKey) => {
                const parentKey = childToParent.get(assetKey);
                if (parentKey && assetMap.has(parentKey)) {
                    // Î∂ÄÎ™®Í∞Ä ÏûàÏúºÎ©¥ Î∂ÄÎ™®Ïùò childrenÏóê Ï∂îÍ∞Ä
                    assetMap.get(parentKey).children.push(asset);
                } else {
                    // Î∂ÄÎ™®Í∞Ä ÏóÜÏúºÎ©¥ Î£®Ìä∏ ÎÖ∏Îìú
                    rootNodes.push(asset);
                }
            });

            // 4. children Ï†ïÎ†¨ (Ïù¥Î¶ÑÏàú)
            const sortChildren = (nodes) => {
                nodes.sort((a, b) => a.name.localeCompare(b.name));
                nodes.forEach(node => {
                    if (node.children.length > 0) sortChildren(node.children);
                });
            };
            sortChildren(rootNodes);

            _treeData = rootNodes;
            console.log('[Preview] Tree built:', rootNodes.length, 'root nodes');

            // Ìä∏Î¶¨ Î†åÎçîÎßÅ
            renderTreeNodes(_treeData, treeSearchTerm);
        }

        // ==================
        // TREE RENDERING
        // ==================

        function renderTreeNodes(items, searchTerm = '') {
            const rootEl = panel.querySelector('.tree-root');
            if (!rootEl) return;

            rootEl.innerHTML = '';
            const normalized = searchTerm.toLowerCase().trim();

            items.forEach(item => {
                const nodeEl = createTreeNode(item, normalized);
                if (nodeEl) rootEl.appendChild(nodeEl);
            });
        }

        function createTreeNode(item, searchTerm) {
            const { assetKey, assetType, statusType, name, children = [] } = item;
            const hasChildren = children.length > 0;
            const isExpanded = expandedNodes.has(assetKey);
            const isSelected = selectedNodeId === assetKey;

            const matchesSearch = !searchTerm || name.toLowerCase().includes(searchTerm);
            const hasMatchingDescendants = hasChildren && checkDescendants(children, searchTerm);

            if (searchTerm && !matchesSearch && !hasMatchingDescendants) return null;

            const li = document.createElement('li');
            li.className = 'tree-node';
            li.dataset.nodeId = assetKey;
            li.dataset.nodeType = assetType;
            li.dataset.hasChildren = hasChildren;

            const content = document.createElement('div');
            content.className = 'node-content';
            if (isSelected) content.classList.add('selected');

            const toggle = document.createElement('span');
            toggle.className = 'node-toggle';
            if (hasChildren) {
                toggle.textContent = '‚ñ∂';
                if (isExpanded) toggle.classList.add('expanded');
            } else {
                toggle.classList.add('leaf');
            }

            const icon = document.createElement('span');
            icon.className = 'node-icon';
            icon.dataset.type = assetType.toLowerCase();

            const label = document.createElement('span');
            label.className = 'node-label';
            label.textContent = name;

            content.appendChild(toggle);
            content.appendChild(icon);
            content.appendChild(label);

            // Count (Ïª®ÌÖåÏù¥ÎÑà ÎÖ∏ÎìúÎßå)
            if (hasChildren) {
                const count = document.createElement('span');
                count.className = 'node-asset-count';
                count.textContent = `(${children.length})`;
                content.appendChild(count);
            }

            const statusDot = document.createElement('span');
            statusDot.className = `node-status ${statusTypeToDataAttr(statusType)}`;
            content.appendChild(statusDot);

            li.appendChild(content);

            if (hasChildren) {
                const childrenUl = document.createElement('ul');
                childrenUl.className = 'node-children';
                if (isExpanded || (searchTerm && hasMatchingDescendants)) {
                    childrenUl.classList.add('expanded');
                }

                children.forEach(child => {
                    const childEl = createTreeNode(child, searchTerm);
                    if (childEl) childrenUl.appendChild(childEl);
                });

                li.appendChild(childrenUl);
            }

            return li;
        }

        function checkDescendants(children, searchTerm) {
            if (!searchTerm) return false;
            return children.some(child => {
                if (child.name.toLowerCase().includes(searchTerm)) return true;
                return child.children && checkDescendants(child.children, searchTerm);
            });
        }

        // ==================
        // NODE ACTIONS
        // ==================

        function toggleNode(nodeId) {
            if (expandedNodes.has(nodeId)) {
                expandedNodes.delete(nodeId);
            } else {
                expandedNodes.add(nodeId);
            }
            updateNodeVisuals(nodeId);
        }

        function selectNode(nodeId) {
            const prev = panel.querySelector('.node-content.selected');
            if (prev) prev.classList.remove('selected');

            selectedNodeId = nodeId;

            const nodeEl = panel.querySelector(`[data-node-id="${nodeId}"] > .node-content`);
            if (nodeEl) nodeEl.classList.add('selected');

            // ÏÑ†ÌÉùÌïú ÎÖ∏ÎìúÏùò ÌïòÏúÑ Î™®Îì† ÏûêÏÇ∞ Í∞ÄÏ†∏Ïò§Í∏∞
            const node = findNodeByKey(_treeData, nodeId);
            if (node) {
                const descendants = getDescendantAssets(node);
                _filteredAssets = descendants;
                renderTable();
            }

            console.log('[Preview] Node selected:', nodeId);
        }

        function findNodeByKey(items, assetKey) {
            if (!items) return null;
            for (const item of items) {
                if (item.assetKey === assetKey) return item;
                if (item.children) {
                    const found = findNodeByKey(item.children, assetKey);
                    if (found) return found;
                }
            }
            return null;
        }

        function getDescendantAssets(node) {
            const result = [node];
            if (node.children) {
                node.children.forEach(child => {
                    result.push(...getDescendantAssets(child));
                });
            }
            return result;
        }

        function collapseAll() {
            expandedNodes.clear();
            if (_treeData) renderTreeNodes(_treeData, treeSearchTerm);
        }

        function updateNodeVisuals(nodeId) {
            const nodeEl = panel.querySelector(`[data-node-id="${nodeId}"]`);
            if (!nodeEl) return;

            const toggle = nodeEl.querySelector(':scope > .node-content > .node-toggle');
            const children = nodeEl.querySelector(':scope > .node-children');
            const isExpanded = expandedNodes.has(nodeId);

            if (toggle) toggle.classList.toggle('expanded', isExpanded);
            if (children) children.classList.toggle('expanded', isExpanded);
        }

        // ==================
        // TABLE RENDERING
        // ==================

        function renderTable() {
            const pathEl = panel.querySelector('.node-path');
            const countEl = panel.querySelector('.selected-node-info .node-count');

            if (selectedNodeId) {
                const node = findNodeByKey(_treeData, selectedNodeId);
                if (pathEl) pathEl.textContent = node?.name || selectedNodeId;
                if (countEl) countEl.textContent = `${_filteredAssets.length}Í∞ú`;
            } else {
                if (pathEl) pathEl.textContent = 'All Assets';
                if (countEl) countEl.textContent = `${_assets.length}Í∞ú`;
            }

            applyFilters();
        }

        function applyFilters() {
            const search = searchTerm.toLowerCase();
            const sourceData = selectedNodeId ? _filteredAssets : _assets;

            const filtered = sourceData.filter(asset => {
                const matchesSearch = !search ||
                    asset.name.toLowerCase().includes(search) ||
                    asset.assetKey.toLowerCase().includes(search);
                const matchesType = typeFilter === 'all' || asset.assetType.toLowerCase() === typeFilter;
                const matchesStatus = statusFilter === 'all' || statusTypeToDataAttr(asset.statusType) === statusFilter;
                return matchesSearch && matchesType && matchesStatus;
            });

            if (tableInstance) {
                tableInstance.setData(filtered);
            }

            const countEl = panel.querySelector('.count-value');
            if (countEl) countEl.textContent = filtered.length;
        }

        // ==================
        // TABLE INIT
        // ==================

        function initTable() {
            const container = panel.querySelector('.table-container');
            if (!container) return;

            container.id = 'asset-table';

            tableInstance = new Tabulator('#asset-table', {
                layout: 'fitColumns',
                height: 350,
                placeholder: 'Select a location from the tree',
                selectable: 1,
                pagination: true,
                paginationSize: 50,
                paginationSizeSelector: [25, 50, 100, 200],
                paginationCounter: 'rows',
                columns: [
                    { title: 'Key', field: 'assetKey', widthGrow: 1, headerSort: true },
                    { title: 'Name', field: 'name', widthGrow: 2, headerSort: true },
                    {
                        title: 'Type', field: 'assetType', widthGrow: 1, headerSort: true,
                        formatter: cell => {
                            const value = cell.getValue();
                            return `<span class="type-badge" data-type="${value.toLowerCase()}">${value}</span>`;
                        }
                    },
                    {
                        title: 'Status', field: 'statusType', widthGrow: 1, headerSort: true,
                        formatter: cell => {
                            const value = cell.getValue();
                            const label = statusTypeToLabel(value);
                            return `<span class="status-badge" data-status="${statusTypeToDataAttr(value)}">${label}</span>`;
                        }
                    }
                ]
            });

            tableInstance.on('rowClick', async (e, row) => {
                const asset = row.getData();
                const { assetKey } = asset;

                // Modal Ïó¥Í∏∞ (Î°úÎî© ÏÉÅÌÉú) - register.jsÏôÄ ÎèôÏùº
                showModal({ asset, loading: true });

                // assetDetailUnified API Ìò∏Ï∂ú (/api/v1/ast/gx)
                try {
                    console.log(`[AssetList] Fetching assetDetailUnified for: ${assetKey}`);
                    const { response } = await fetchAssetDetailUnified(assetKey);
                    const data = response?.data;

                    if (data && data.asset) {
                        console.log(`[AssetList] Asset detail (unified):`, data);
                        // ÏõêÎ≥∏ asset Ï†ïÎ≥¥(assetKey, assetType)ÏôÄ API ÏùëÎãµ(name, statusType) Î≥ëÌï©
                        showModal({ asset: { ...asset, ...data.asset }, properties: data.properties || [] });
                    } else {
                        showModal({ asset, error: true });
                    }
                } catch (error) {
                    console.error(`[AssetList] Failed to fetch assetDetailUnified for ${assetKey}:`, error);
                    showModal({ asset, error: true });
                }
            });
        }

        // ==================
        // MODAL
        // ==================

        /**
         * Î™®Îã¨ ÌëúÏãú - register.jsÏùò showModalÍ≥º ÎèôÏùºÌïú Íµ¨Ï°∞
         * @param {{ asset, properties?, loading?, error? }} params
         */
        function showModal({ asset, properties, loading, error }) {
            const modal = panel.querySelector('.asset-modal');
            if (!modal) return;

            const { assetKey, name, assetType, statusType } = asset;

            // Ìó§Îçî ÏóÖÎç∞Ïù¥Ìä∏ (register.jsÏôÄ ÎèôÏùº)
            modal.querySelector('.modal-title').textContent = name || assetKey;
            modal.querySelector('.modal-subtitle').textContent = `${assetType} ¬∑ ${assetKey}`;
            const statusEl = modal.querySelector('.modal-status');
            statusEl.textContent = statusTypeToLabel(statusType);
            statusEl.dataset.status = statusTypeToDataAttr(statusType);

            // Î∞îÎîî ÏóÖÎç∞Ïù¥Ìä∏
            const grid = modal.querySelector('.modal-info-grid');
            renderModalBody(grid, { loading, error, properties });

            // Modal ÌëúÏãú
            modal.hidden = false;

            // Îã´Í∏∞ Ïù¥Î≤§Ìä∏
            modal.onclick = (e) => {
                if (e.target.closest('.modal-close-btn') || e.target.classList.contains('modal-overlay')) {
                    modal.hidden = true;
                }
            };
        }

        /**
         * Î™®Îã¨ Î∞îÎîî Î†åÎçîÎßÅ - register.jsÏùò renderModalBodyÏôÄ ÎèôÏùº
         */
        function renderModalBody(grid, { loading, error, properties }) {
            if (loading) {
                grid.innerHTML = '<div class="modal-loading"></div>';
                return;
            }

            if (error) {
                grid.innerHTML = `
                    <div class="modal-no-api wide">
                        <div class="modal-no-api-icon">‚ö†Ô∏è</div>
                        <div class="modal-no-api-text">Failed to load data</div>
                    </div>
                `;
                return;
            }

            if (properties && properties.length > 0) {
                grid.innerHTML = renderPropertiesGrid(properties);
            } else {
                grid.innerHTML = `
                    <div class="modal-no-api wide">
                        <div class="modal-no-api-text">No properties available</div>
                    </div>
                `;
            }
        }

        /**
         * ÌÜµÌï© API properties[] Î∞∞Ïó¥ÏùÑ HTML Í∑∏Î¶¨ÎìúÎ°ú Î≥ÄÌôò - register.jsÏôÄ ÎèôÏùº
         */
        function renderPropertiesGrid(properties) {
            const sortedProperties = [...properties].sort((a, b) => (a.displayOrder || 0) - (b.displayOrder || 0));
            return sortedProperties
                .map(({ label, value, helpText }) => {
                    return `
                        <div class="modal-info-item" title="${helpText || ''}">
                            <div class="modal-info-label">${label}</div>
                            <div class="modal-info-value">${value ?? '-'}</div>
                        </div>
                    `;
                })
                .join('');
        }

        // ==================
        // RESIZER
        // ==================

        function setupResizer() {
            const resizer = panel.querySelector('.pane-resizer');
            const treePane = panel.querySelector('.tree-pane');
            if (!resizer || !treePane) return;

            let isResizing = false;
            let startX = 0;
            let startWidth = 0;

            resizer.addEventListener('mousedown', (e) => {
                isResizing = true;
                startX = e.clientX;
                startWidth = treePane.offsetWidth;
                resizer.classList.add('dragging');
                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
                e.preventDefault();
            });

            function onMouseMove(e) {
                if (!isResizing) return;
                const diff = e.clientX - startX;
                const newWidth = Math.min(400, Math.max(200, startWidth + diff));
                treePane.style.width = `${newWidth}px`;
            }

            function onMouseUp() {
                isResizing = false;
                resizer.classList.remove('dragging');
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
            }
        }

        // ==================
        // EVENT HANDLERS
        // ==================

        function setupEventHandlers() {
            // Tree click (event delegation)
            panel.querySelector('.tree-container')?.addEventListener('click', (e) => {
                const nodeContent = e.target.closest('.node-content');
                if (!nodeContent) return;

                const nodeEl = nodeContent.closest('.tree-node');
                if (!nodeEl) return;

                const nodeId = nodeEl.dataset.nodeId;
                const toggle = nodeContent.querySelector('.node-toggle');

                if (e.target.closest('.node-toggle') && !toggle.classList.contains('leaf')) {
                    toggleNode(nodeId);
                } else {
                    selectNode(nodeId);
                }
            });

            // Tree search
            panel.querySelector('.tree-search-input')?.addEventListener('input', (e) => {
                treeSearchTerm = e.target.value;
                if (_treeData) renderTreeNodes(_treeData, treeSearchTerm);
            });

            // Collapse button
            panel.querySelector('.btn-collapse-all')?.addEventListener('click', collapseAll);

            // Table search
            panel.querySelector('.search-input')?.addEventListener('input', (e) => {
                searchTerm = e.target.value;
                applyFilters();
            });

            // Type filter
            panel.querySelector('.type-filter')?.addEventListener('change', (e) => {
                typeFilter = e.target.value;
                applyFilters();
            });

            // Status filter
            panel.querySelector('.status-filter')?.addEventListener('change', (e) => {
                statusFilter = e.target.value;
                applyFilters();
            });

            // Refresh button
            panel.querySelector('.refresh-btn')?.addEventListener('click', loadData);
        }

        // ==================
        // DATA LOADING (Asset API v1)
        // ==================

        async function loadData() {
            console.log('[Preview] Loading data (Asset API v1)...');

            try {
                const [assetResult, relationResult] = await Promise.all([
                    fetchAssetList(),
                    fetchRelationList()
                ]);

                _assets = assetResult.response?.data || [];
                _relations = relationResult.response?.data || [];

                console.log('[Preview] Assets:', _assets.length, 'Relations:', _relations.length);

                // Ìä∏Î¶¨ ÎπåÎìú
                buildTree();

                // ÌÖåÏù¥Î∏î Ï¥àÍ∏∞ Î†åÎçîÎßÅ
                renderTable();

            } catch (error) {
                console.error('[Preview] Failed to load data:', error);
            }
        }

        // ==================
        // INIT
        // ==================

        window.onload = () => {
            initTable();
            setupResizer();
            setupEventHandlers();
            loadData();
        };
    </script>
</body>
</html>
